syntax = "proto3";

package com.silhouette.api.v1;

import "google/protobuf/timestamp.proto";

import "address.proto";
import "phone.proto";
import "auth.proto";

// Profiles service provide functions for managing user profiles
service Profiles {
  
    // CreateProfile creates a new user profile. 
    // This should happen during user registration.
    rpc CreateProfile(CreateProfileRequest) returns (Profile){
        option (auth_config) = {
            required_scopes: ["w:silhouette:s2s:*","w:silhouette:s2s:profile:*"]
            self_access_allowed: false
            s2s_only_allowed: true
        };
    };

    // GetProfile returns the entire silhouette profile by username including 
    // address and phone. 
    rpc GetProfile(GetProfileRequest) returns (Profile){
        option (auth_config) = {
            required_scopes: ["r:silhouette:*","r:silhouette:profile:*"]
            self_access_allowed: true
        };
    };

    // UpdateProfile updates an existing user profile.
    // This will not include an update of address or phone,
    // Those will be a separate call
    rpc UpdateProfile(UpdateProfileRequest) returns (Profile){
        option (auth_config) = {
            required_scopes: ["w:silhouette:*","w:silhouette:profile:*"]
            self_access_allowed: true
        };
    };
}

// Profile is a model representing a user's site profile attributes.
// This will include ancillary attributes like nickname not included in
// the identity service account data, as well as UI preferences, etc.
message Profile {
    string uuid = 1;
    string username = 2;
    optional string nick_name = 3;
    bool dark_mode = 4;
    google.protobuf.Timestamp updated_at = 5;
    google.protobuf.Timestamp created_at = 6;
    repeated Address address = 7;
    repeated Phone phone = 8;
}

// CreateProfileRequest is the request message for creating a new user profile.
message CreateProfileRequest {
    string username = 1;
    optional string nick_name = 2;
    // darkmode enabled by default
    // address and phone not collected at registration
}

// GetProfileRequest is the request message for retrieving a user profile by username.
message GetProfileRequest {
    string username = 1;
}

// UpdateProfileRequest updates a the fields in a user profile by username,
// but does not include phone or address updates.   
message UpdateProfileRequest {
    // username is the search criteria, username is immutable
    string username = 1;

    // nick_name is updatable
    optional string nick_name = 2;

    // dark_mode is updatable
    bool dark_mode = 3;
}